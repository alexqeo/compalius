#!/usr/bin/env node

var util = require('util'),
		exec = require('child_process').exec,
		colors = require('colors'),
		execCommand;

var args = process.argv.slice(2);

if(args[0]){
	var execString;
	var fileExtension = args[0].split('.').pop();
	var targetFile = (args[2]) ? args[2] : (args.indexOf('-min') > -1) ? args[0].split('.').shift() + '.min.css' : args[0].split('.').shift() + '.css';
	var modulePath = __dirname + '/../node_modules/';
	var minString = (args.indexOf('-min') > -1) ? ' && ' + modulePath + 'clean-css/bin/cleancss -o ' + targetFile + ' ' + targetFile : '';
	if(fileExtension == 'less') execString = modulePath + 'less/bin/lessc ' + args[0] + ' > ' + targetFile + minString;
	else if(fileExtension == 'scss') execString = modulePath + 'node-sass/bin/node-sass <' + args[0] + '> ' + targetFile;
	else if(fileExtension == 'styl') execString = modulePath + 'stylus/bin/stylus < ' + args[0] + ' > ' + targetFile;
	else {
		console.log('Error: Wrong file extension'.red);
		process.exit();
	}
	execCommand = exec(execString,
	  function (error, stdout, stderr) {
	    if (error !== null) {
	      console.log(error.red);
	    }
	    else {
	    	var logString = 'Compiled successfully into ' + targetFile;
	    	console.log(logString.green);	
	    }
	});
}